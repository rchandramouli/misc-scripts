#include <stdio.h>
#include <malloc.h>
#include <string.h>

typedef unsigned long long int u64;

static int n, r, *p;
static int *bt;

static u64 factorial(int n)
{
	u64 pdt = 1;

	while (n) {
		pdt *= n;
		n--;
	}

	return pdt;
}

static void dump_perm(void)
{
	int i;

	printf("(");
	for (i = 0; i < n; i++) {
		printf("%2d ", p[i]+1);
	}
	printf(")\n");
}

static void get_perm_by_rank(int rank)
{
	u64 q, N = n-1, f = factorial(N);
	int i = 0, j, k;

	memset(bt, 0, sizeof(int)*n);

	while (f) {
		q = rank/f;
		for (j = k = 0; k <= q && j < n; j++)
			if (!bt[j]) k++;
		j--;
		p[i] = j;
		bt[j] = 1;
		i++;
		rank = rank % f;
		f = (N) ? f/N: 0;
		N--;
	}
}

static u64 get_rank_by_perm(int *perm, int n)
{
	u64 rank = 0, N = n-1, f = factorial(N);
	int i = 0, j, k;

	memset(bt, 0, sizeof(int)*n);

	while (i < n) {
		for (j = k = 0; j != perm[i] && j < n; j++) {
			if (!bt[j]) k++;
		}
		bt[perm[i]] = 1;
		rank += f*k;
		i++;
		f /= (N) ? N: 1;
		N--;
	}

	return rank;
}

static int alloc_mem(int n)
{
	p = (int *)malloc(sizeof(int)*n);
	if (!p) return 1;

	bt = (int *)malloc(sizeof(int)*n);
	if (!bt) {
		free(p);
		return 1;
	}

	return 0;
}

/*
  S2: For n = 7:
  1, 3, 7, 9, 13, 15, 25, 27, 31, 33, 37, 39, 49, 51, 55, 57, 61, 63, 73, 75, 79, 81, 85, 87, 121, 123, 127, 129, 133, 135, 145, 147, 151, 153, 157, 159, 169, 171, 175, 177, 181, 183, 193, 195, 199, 201, 205, 207, 241, 243, 247, 249, 253, 255, 265, 267, 271, 273, 277, 279, 289, 291, 295, 297, 301, 303, 313, 315, 319, 321, 325, 327, 361, 363, 367, 369, 373, 375, 385, 387, 391, 393, 397, 399, 409, 411, 415, 417, 421, 423, 433, 435, 439, 441, 445, 447, 481, 483, 487, 489, 493, 495, 505, 507, 511, 513, 517, 519, 529, 531, 535, 537, 541, 543, 553, 555, 559, 561, 565, 567, 721, 723, 727, 729, 733, 735, 745, 747, 751, 753, 757, 759, 769, 771, 775, 777, 781, 783, 793, 795, 799, 801, 805, 807, 841, 843, 847, 849, 853, 855, 865, 867, 871, 873, 877, 879, 889, 891, 895, 897, 901, 903, 913, 915, 919, 921, 925, 927, 961, 963, 967, 969, 973, 975, 985, 987, 991, 993, 997, 999, 1009, 1011, 1015, 1017, 1021, 1023, 1033, 1035, 1039, 1041, 1045, 1047, 1081, 1083, 1087, 1089, 1093, 1095, 1105, 1107, 1111, 1113, 1117, 1119, 1129, 1131, 1135, 1137, 1141, 1143, 1153, 1155, 1159, 1161, 1165, 1167, 1201, 1203, 1207, 1209, 1213, 1215, 1225, 1227, 1231, 1233, 1237, 1239, 1249, 1251, 1255, 1257, 1261, 1263, 1273, 1275, 1279, 1281, 1285, 1287, 1441, 1443, 1447, 1449, 1453, 1455, 1465, 1467, 1471, 1473, 1477, 1479, 1489, 1491, 1495, 1497, 1501, 1503, 1513, 1515, 1519, 1521, 1525, 1527, 1561, 1563, 1567, 1569, 1573, 1575, 1585, 1587, 1591, 1593, 1597, 1599, 1609, 1611, 1615, 1617, 1621, 1623, 1633, 1635, 1639, 1641, 1645, 1647, 1681, 1683, 1687, 1689, 1693, 1695, 1705, 1707, 1711, 1713, 1717, 1719, 1729, 1731, 1735, 1737, 1741, 1743, 1753, 1755, 1759, 1761, 1765, 1767, 1801, 1803, 1807, 1809, 1813, 1815, 1825, 1827, 1831, 1833, 1837, 1839, 1849, 1851, 1855, 1857, 1861, 1863, 1873, 1875, 1879, 1881, 1885, 1887, 1921, 1923, 1927, 1929, 1933, 1935, 1945, 1947, 1951, 1953, 1957, 1959, 1969, 1971, 1975, 1977, 1981, 1983, 1993, 1995, 1999, 2001, 2005, 2007, 2161, 2163, 2167, 2169, 2173, 2175, 2185, 2187, 2191, 2193, 2197, 2199, 2209, 2211, 2215, 2217, 2221, 2223, 2233, 2235, 2239, 2241, 2245, 2247, 2281, 2283, 2287, 2289, 2293, 2295, 2305, 2307, 2311, 2313, 2317, 2319, 2329, 2331, 2335, 2337, 2341, 2343, 2353, 2355, 2359, 2361, 2365, 2367, 2401, 2403, 2407, 2409, 2413, 2415, 2425, 2427, 2431, 2433, 2437, 2439, 2449, 2451, 2455, 2457, 2461, 2463, 2473, 2475, 2479, 2481, 2485, 2487, 2521, 2523, 2527, 2529, 2533, 2535, 2545, 2547, 2551, 2553, 2557, 2559, 2569, 2571, 2575, 2577, 2581, 2583, 2593, 2595, 2599, 2601, 2605, 2607, 2641, 2643, 2647, 2649, 2653, 2655, 2665, 2667, 2671, 2673, 2677, 2679, 2689, 2691, 2695, 2697, 2701, 2703, 2713, 2715, 2719, 2721, 2725, 2727, 2881, 2883, 2887, 2889, 2893, 2895, 2905, 2907, 2911, 2913, 2917, 2919, 2929, 2931, 2935, 2937, 2941, 2943, 2953, 2955, 2959, 2961, 2965, 2967, 3001, 3003, 3007, 3009, 3013, 3015, 3025, 3027, 3031, 3033, 3037, 3039, 3049, 3051, 3055, 3057, 3061, 3063, 3073, 3075, 3079, 3081, 3085, 3087, 3121, 3123, 3127, 3129, 3133, 3135, 3145, 3147, 3151, 3153, 3157, 3159, 3169, 3171, 3175, 3177, 3181, 3183, 3193, 3195, 3199, 3201, 3205, 3207, 3241, 3243, 3247, 3249, 3253, 3255, 3265, 3267, 3271, 3273, 3277, 3279, 3289, 3291, 3295, 3297, 3301, 3303, 3313, 3315, 3319, 3321, 3325, 3327, 3361, 3363, 3367, 3369, 3373, 3375, 3385, 3387, 3391, 3393, 3397, 3399, 3409, 3411, 3415, 3417, 3421, 3423, 3433, 3435, 3439, 3441, 3445, 3447, 3601, 3603, 3607, 3609, 3613, 3615, 3625, 3627, 3631, 3633, 3637, 3639, 3649, 3651, 3655, 3657, 3661, 3663, 3673, 3675, 3679, 3681, 3685, 3687, 3721, 3723, 3727, 3729, 3733, 3735, 3745, 3747, 3751, 3753, 3757, 3759, 3769, 3771, 3775, 3777, 3781, 3783, 3793, 3795, 3799, 3801, 3805, 3807, 3841, 3843, 3847, 3849, 3853, 3855, 3865, 3867, 3871, 3873, 3877, 3879, 3889, 3891, 3895, 3897, 3901, 3903, 3913, 3915, 3919, 3921, 3925, 3927, 3961, 3963, 3967, 3969, 3973, 3975, 3985, 3987, 3991, 3993, 3997, 3999, 4009, 4011, 4015, 4017, 4021, 4023, 4033, 4035, 4039, 4041, 4045, 4047, 4081, 4083, 4087, 4089, 4093, 4095, 4105, 4107, 4111, 4113, 4117, 4119, 4129, 4131, 4135, 4137, 4141, 4143, 4153, 4155, 4159, 4161, 4165, 4167

  S3: For n=7
  1, 7, 25, 31, 49, 55, 121, 127, 145, 151, 169, 175, 241, 247, 265, 271, 289, 295, 361, 367, 385, 391, 409, 415, 721, 727, 745, 751, 769, 775, 841, 847, 865, 871, 889, 895, 961, 967, 985, 991, 1009, 1015, 1081, 1087, 1105, 1111, 1129, 1135, 1441, 1447, 1465, 1471, 1489, 1495, 1561, 1567, 1585, 1591, 1609, 1615, 1681, 1687, 1705, 1711, 1729, 1735, 1801, 1807, 1825, 1831, 1849, 1855, 2161, 2167, 2185, 2191, 2209, 2215, 2281, 2287, 2305, 2311, 2329, 2335, 2401, 2407, 2425, 2431, 2449, 2455, 2521, 2527, 2545, 2551, 2569, 2575, 2881, 2887, 2905, 2911, 2929, 2935, 3001, 3007, 3025, 3031, 3049, 3055, 3121, 3127, 3145, 3151, 3169, 3175, 3241, 3247, 3265, 3271, 3289, 3295,

*/
static void find_all_fixpoint_ranks(int n)
{
	u64 prank, f = factorial(n), rcount;
	int i, j;

	for (prank = rcount = 0; prank < f; prank++) {
		get_perm_by_rank(prank);

		/* S1: A153880 */
		/* if (p[n-1] == n-1) */

		/* S2: NO ENTRY FOUND */
		/* if (p[n-2] == n-1) */

		/* S3: NO ENTRY FOUND */
		/* if (p[n-2] == n-1 && p[n-1] == n-2) */

		for (i = j = 0; i < n; i++) {
			/* S4: A138523: Needs comment addition */
			/* if (p[i] == i+1 || p[i] == i-1) */
			/* if (p[i] == p[p[i]]+1 || p[i] == p[p[i]]-1) */

			/* S5: A033305 */
			/* if (p[i] == i+2 || p[i] == i-2 || */
			/*    p[i] == i+1 || p[i] == i-1) */

			/* S6: A037223 */
			/* if (p[i] + p[n-i-1] == n-1) */

			/* S7: A037224 */
			/* if (i+p[p[i]] == n-1) */

			/* S8: A000085 */
			/* NOTE: if, p[p[p[i]]] = p[i], then we count self inverses! */
			/* if (i+p[p[p[i]]] == p[i]+p[p[i]]) */

			/* S9: UNKNOWN */
			/* 0,1,1,2,1,5,1,8,6,9,1 */
			/* if (((i*p[i])%n) == (i*p[p[i]])%n) */

			/* S10: UNKNOWN */
			/* 0,1,1,2,4,4,4,8,96,48,16 */
			/* if ((i*i)%n == (p[i]*p[i])%n) */

			/* S11: A097899 */
			/* How do these relate to each other? */
			/* if (p[i] > i || p[i] < p[p[i]]) */
			/* if (p[i] > p[p[i]] || p[i] < i) */

			/* S12: UNKNOWN */
			/* 0,0,1,2,7,38,201,1252,8909,69678 */
			/* if (p[i] > p[p[i]] || p[i] < p[p[p[i]]]) */
			/* if (p[i] < p[p[i]] || p[i] > p[p[p[i]]]) */

			/* Till n=9, the 2*n holds good. */
			/* Given an integer k, there exists a maximum
			 * N such that, there is atleast one
			 * permutation of (1,..,N) where i*p[i] < kN
			 * for all 1 <= i <= N and there is no
			 * permutation of (1,...,N+1) satisfying the
			 * above criteria. Relate N & k. For k = 2, N = 9. */
			/* 1,2,6,18,54,72,144,144,36,0 */
			/* if (i*p[i] < 2*n) */

			/* S13: UNKNOWN */
			/* 0,1,3,12,54,294,1866,13474,109674,989490 */
			/* if (p[i] > i || p[i] < 2*p[p[i]]) */

			/* S14: A001563 : update comments */
			/* if (p[i] > p[p[i]] || p[i] < 2*p[p[i]]) */

			/* S15: A052537 : How does this relate? */
			/* if (p[p[i]] != i && (p[p[i]]-p[i] >= -2) && */
			/* (p[p[i]]-p[i] <= 2)) */

			/* S16: UNKNOWN */
			/* 1,1,2,4,6,4,18,40,108,36 */
			/* if (((p[i]*p[i])%n) == ((i*p[p[i]])%n)) */

			/* S17: UNKNOWN */
			/* 1,2,2,4,4,48,8,16,48,1152 */
			/* if (((1+i+i*i)%n) == ((1+p[i]+p[i]*p[i])%n)) */

			/* S18: UNKNOWN */
			/* 0,0,0,1,18,149,1182,10098,94451,958625 */
			/* if (i+p[i]+p[p[i]]+p[p[p[i]]] > 2*p[i]) */

#define pDIFF(m, n)    (p[i]-i >= (m) && p[i]-i <= (n))

			/* S19: A000073 : Tribonacci numbers (0,0,1) */
			/* if (pDIFF(-2, 1)) */

			/* S21: A000078 : Tetranacci numbers (0,0,0,1) */
			/* if (pDIFF(-3, 1)) */
			/*
			 * NOTE: For k >= p[i]-i >= 1, we get (k+1)-nacci numbers
			 *
			 * The below gives fibonacci!
			 * if (pDIFF(-1, 1))
			 *
			 */

			/* S22: A002524 For more, see the description */
			/* if (pDIFF(-2, 2)) */

			/* S23: A072827 */
			/* if (pDIFF(-3, 2)) */

			/* S24: A072850 */
			/* if (pDIFF(-4, 2)) */

			/* For a detailed list of sequences as well as
			 * some informative formulae, for general
			 * consideration: pDIFF(m, n), check: A079978,
			 * A080014, A079955, A072850, A072827,
			 * A072856, A079998, A079962, ...
			 */

			/* S25: UNKNOWN */
			/* 1,1,3,1,11,9,13,1,51,121, */
			/* if ((i^p[i]) == (i|p[i])) */

			/* S26: UNKNOWN */
			/* 1,2,4,16,32,112,400,1856,5056,19072 */
			/* if ((p[p[i]]^p[i]) == (i^p[p[p[i]]])) */
			/* if ((p[i]^p[p[i]]) == (p[p[p[i]]]^p[p[p[p[i]]]])) */

			/* S27: A001470 */
			/* if (p[p[p[i]]] == i) */

			/* S28: (Rank forms A033312) (n!-1) */
			/* if ((p[i]^p[n-i-1]) == (p[p[i]]^p[p[p[i]]])) */

			j++;
		}
		if (j == n) {
			rcount++;
			printf("%Lu, ", prank);
		}
	}
	printf("\ncount: %Lu\n", rcount);
}

int main(int argc, char *argv[])
{
	scanf("%d", &n);
	if (n <= 0 || alloc_mem(n)) return -1;

	find_all_fixpoint_ranks(n);

	return 0;
}

int p1_main(int argc, char *argv[])
{
	scanf("%d %d", &n, &r);
	if (n <= 0 || alloc_mem(n)) return -1;

	get_perm_by_rank(r);
	printf("Rank: %llu\n", get_rank_by_perm(p, n));
	dump_perm();

	return 0;
}
